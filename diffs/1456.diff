1456.diff --- 1457_stable.py	2026-01-21 17:06:14
+++ perf_takehome.py	2026-01-21 17:15:03
@@ -483,16 +483,32 @@
                 if next_block >= vector_blocks or not free_bufs:
                     return False
                 buf_idx = free_bufs.pop(0)
-                active.append({
-                    "block": next_block,
-                    "buf_idx": buf_idx,
-                    "buf": buffers[buf_idx],
-                    "offset": block_offsets[next_block],
-                    "phase": "init_addr",
-                    "round": 0,
-                    "stage": 0,
-                    "gather": 0,
-                })
+                buf = buffers[buf_idx]
+                # Block 0 optimization: offset is 0, so use base pointers directly
+                if next_block == 0:
+                    active.append({
+                        "block": next_block,
+                        "buf_idx": buf_idx,
+                        "buf": buf,
+                        "offset": block_offsets[next_block],
+                        "phase": "vload",  # Skip init_addr
+                        "round": 0,
+                        "stage": 0,
+                        "gather": 0,
+                        "direct_idx_addr": self.scratch["inp_indices_p"],
+                        "direct_val_addr": self.scratch["inp_values_p"],
+                    })
+                else:
+                    active.append({
+                        "block": next_block,
+                        "buf_idx": buf_idx,
+                        "buf": buf,
+                        "offset": block_offsets[next_block],
+                        "phase": "init_addr",
+                        "round": 0,
+                        "stage": 0,
+                        "gather": 0,
+                    })
                 next_block += 1
                 return True
 
@@ -575,7 +591,8 @@
                         break
                     if block["phase"] == "store_both" and block["block"] not in scheduled_this_cycle:
                         buf = block["buf"]
-                        store_ops.append(("vstore", buf["val_addr"], buf["val"]))
+                        val_addr = block.get("direct_val_addr", buf["val_addr"])
+                        store_ops.append(("vstore", val_addr, buf["val"]))
                         block["next_phase"] = "store_idx"
                         scheduled_this_cycle.add(block["block"])
                         store_slots -= 1
@@ -585,7 +602,8 @@
                         break
                     if block["phase"] == "store_idx" and block["block"] not in scheduled_this_cycle:
                         buf = block["buf"]
-                        store_ops.append(("vstore", buf["idx_addr"], buf["idx"]))
+                        idx_addr = block.get("direct_idx_addr", buf["idx_addr"])
+                        store_ops.append(("vstore", idx_addr, buf["idx"]))
                         block["next_phase"] = "done"
                         scheduled_this_cycle.add(block["block"])
                         store_slots -= 1
@@ -596,8 +614,10 @@
                         break
                     if block["phase"] == "vload" and block["block"] not in scheduled_this_cycle:
                         buf = block["buf"]
-                        load_ops.append(("vload", buf["idx"], buf["idx_addr"]))
-                        load_ops.append(("vload", buf["val"], buf["val_addr"]))
+                        idx_addr = block.get("direct_idx_addr", buf["idx_addr"])
+                        val_addr = block.get("direct_val_addr", buf["val_addr"])
+                        load_ops.append(("vload", buf["idx"], idx_addr))
+                        load_ops.append(("vload", buf["val"], val_addr))
                         # For round 0, skip addr and gather phases (all idx=0, use tree0_v)
                         if block["round"] == 0:
                             block["next_phase"] = "round0_xor"
